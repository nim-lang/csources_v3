/* Generated by Nim Compiler v2.3.1 */
#define NIM_INTBITS 64
#include "nimbase.h"
#include <string.h>
#include <stdlib.h>
#include <errno.h>
#undef LANGUAGE_C
#undef MIPSEB
#undef MIPSEL
#undef PPC
#undef R3000
#undef R4000
#undef i386
#undef linux
#undef mips
#undef near
#undef far
#undef powerpc
#undef unix
typedef struct NimStrPayload NimStrPayload;
typedef struct NimStringV2 NimStringV2;
typedef struct tyObject_WideCStringObj__Y4mbfz4JpRWlVii9b3ufnsg tyObject_WideCStringObj__Y4mbfz4JpRWlVii9b3ufnsg;
typedef struct tySequence__lBgZ7a89beZGYPl8PiANMTA tySequence__lBgZ7a89beZGYPl8PiANMTA;
typedef struct tySequence__lBgZ7a89beZGYPl8PiANMTA_Content tySequence__lBgZ7a89beZGYPl8PiANMTA_Content;
struct NimStrPayload {
	NI cap;
	NIM_CHAR data[SEQ_DECL_SIZE];
};
struct NimStringV2 {
	NI len;
	NimStrPayload* p;
};
struct tyObject_WideCStringObj__Y4mbfz4JpRWlVii9b3ufnsg {
	NI bytes;
	NI16* data;
};
typedef NI16 tyUncheckedArray__Tyd4y3haUOOHTj71TPIRag[1];
struct tySequence__lBgZ7a89beZGYPl8PiANMTA {
	NI len;
	tySequence__lBgZ7a89beZGYPl8PiANMTA_Content* p;
};
typedef N_STDCALL_PTR(NI32, tyProc__bqj9c9cp9clcknaC0kHFkuNVg)(NI16* lpName_p0, NI16* lpValue_p1);
struct tySequence__lBgZ7a89beZGYPl8PiANMTA_Content {
	NI cap;
	NIM_CHAR data[SEQ_DECL_SIZE];
};
static N_INLINE(void, nimZeroMem)(void* p_p0, NI size_p1);
static N_INLINE(void, nimSetMem__systemZmemory_u7)(void* a_p0, int v_p1, NI size_p2);
static N_INLINE(NIM_BOOL*, nimErrorFlag)(void);
static N_INLINE(NI16*, toWideCString__stdZwidestrs_u49)(tyObject_WideCStringObj__Y4mbfz4JpRWlVii9b3ufnsg x_p0);
N_LIB_PRIVATE N_NIMCALL(tyObject_WideCStringObj__Y4mbfz4JpRWlVii9b3ufnsg, newWideCString__stdZwidestrs_u325)(NimStringV2 s_p0);
N_LIB_PRIVATE N_NIMCALL(void, eqdestroy___stdZwidestrs_u7)(tyObject_WideCStringObj__Y4mbfz4JpRWlVii9b3ufnsg a_p0);
N_LIB_PRIVATE N_NIMCALL(void, eqdestroy___system_u2624)(NimStringV2 dest_p0);
static N_INLINE(void, appendString)(NimStringV2* dest_p0, NimStringV2 src_p1);
static N_INLINE(void, copyMem__system_u1724)(void* dest_p0, void* source_p1, NI size_p2);
static N_INLINE(void, nimCopyMem)(void* dest_p0, void* source_p1, NI size_p2);
N_LIB_PRIVATE N_NIMCALL(NimStringV2, rawNewString)(NI space_p0);
N_LIB_PRIVATE N_NIMCALL(tySequence__lBgZ7a89beZGYPl8PiANMTA, newSeq__stdZprivateZwin95setenv_u59)(NI len_p0);
N_LIB_PRIVATE N_NIMCALL(void, eqdestroy___stdZprivateZwin95setenv_u144)(tySequence__lBgZ7a89beZGYPl8PiANMTA dest_p0);
N_LIB_PRIVATE N_NIMCALL(void*, nimLoadLibrary)(NimStringV2 path_p0);
N_LIB_PRIVATE N_NIMCALL(void, nimLoadLibraryError)(NimStringV2 path_p0);
N_LIB_PRIVATE N_NIMCALL(void*, nimGetProcAddr)(void* lib_p0, NCSTRING name_p1);
static const struct {
	NI cap;
	NIM_CHAR data[2];
} TM__UOYsq9cbb0VE8vr3Xt181HA_2 = {(1 | NIM_STRLIT_FLAG), "="};
static const NimStringV2 TM__UOYsq9cbb0VE8vr3Xt181HA_3 = {1, ((NimStrPayload*) (&TM__UOYsq9cbb0VE8vr3Xt181HA_2))};
static const struct {
	NI cap;
	NIM_CHAR data[4];
} TM__UOYsq9cbb0VE8vr3Xt181HA_4 = {(3 | NIM_STRLIT_FLAG), "=  "};
static const NimStringV2 TM__UOYsq9cbb0VE8vr3Xt181HA_5 = {3, ((NimStrPayload*) (&TM__UOYsq9cbb0VE8vr3Xt181HA_4))};
static const struct {
	NI cap;
	NIM_CHAR data[9];
} TM__UOYsq9cbb0VE8vr3Xt181HA_8 = {(8 | NIM_STRLIT_FLAG), "kernel32"};
static const NimStringV2 TM__UOYsq9cbb0VE8vr3Xt181HA_9 = {8, ((NimStrPayload*) (&TM__UOYsq9cbb0VE8vr3Xt181HA_8))};
static const struct {
	NI cap;
	NIM_CHAR data[9];
} TM__UOYsq9cbb0VE8vr3Xt181HA_10 = {(8 | NIM_STRLIT_FLAG), "kernel32"};
static const NimStringV2 TM__UOYsq9cbb0VE8vr3Xt181HA_11 = {8, ((NimStrPayload*) (&TM__UOYsq9cbb0VE8vr3Xt181HA_10))};
extern NIM_CHAR** _environ;
extern NIM_BOOL nimInErrorMode__system_u4211;
static void* TM__UOYsq9cbb0VE8vr3Xt181HA_6;
tyProc__bqj9c9cp9clcknaC0kHFkuNVg Dl_1694498819_;
static N_INLINE(void, nimSetMem__systemZmemory_u7)(void* a_p0, int v_p1, NI size_p2) {
	void* T1_;
T1_ = ((void*) 0);
T1_ = memset(a_p0, v_p1, ((size_t) (size_p2)));
}

static N_INLINE(NIM_BOOL*, nimErrorFlag)(void) {
	NIM_BOOL* result;
result = ((&nimInErrorMode__system_u4211));
	return result;
}

static N_INLINE(void, nimZeroMem)(void* p_p0, NI size_p1) {
	NIM_BOOL* nimErr_;
{
		nimErr_ = nimErrorFlag();
nimSetMem__systemZmemory_u7(p_p0, ((int) 0), size_p1);
if (NIM_UNLIKELY((*nimErr_))) {
	goto BeforeRet_;
}
}
	BeforeRet_: ;
}

static N_INLINE(NI16*, toWideCString__stdZwidestrs_u49)(tyObject_WideCStringObj__Y4mbfz4JpRWlVii9b3ufnsg x_p0) {
	NI16* result;
result = x_p0.data;
	return result;
}

static N_INLINE(void, nimCopyMem)(void* dest_p0, void* source_p1, NI size_p2) {
	void* T1_;
T1_ = ((void*) 0);
T1_ = memcpy(dest_p0, source_p1, ((size_t) (size_p2)));
}

static N_INLINE(void, copyMem__system_u1724)(void* dest_p0, void* source_p1, NI size_p2) {
	nimCopyMem(dest_p0, source_p1, size_p2);
}

static N_INLINE(void, appendString)(NimStringV2* dest_p0, NimStringV2 src_p1) {
	{
	if ((!((((NI) 0) < src_p1.len)))) {
	goto LA3_;
}
copyMem__system_u1724(((void*) (((&(*(*dest_p0).p).data[(*dest_p0).len])))), ((void*) (((&(*src_p1.p).data[((NI) 0)])))), (src_p1.len));
(*dest_p0).len += src_p1.len;
(*(*dest_p0).p).data[(*dest_p0).len] = 0;
}
LA3_: ;
}

N_LIB_PRIVATE N_NIMCALL(int, setEnvImpl__stdZprivateZwin95setenv_u18)(NimStringV2 name_p0, NimStringV2 value_p1, int overwrite_p2) {
	int result;
tyObject_WideCStringObj__Y4mbfz4JpRWlVii9b3ufnsg colontmpD_;
NimStringV2 colontmpD__2;
tyObject_WideCStringObj__Y4mbfz4JpRWlVii9b3ufnsg colontmpD__3;
tyObject_WideCStringObj__Y4mbfz4JpRWlVii9b3ufnsg colontmpD__4;
NI16* wideName_1;
NIM_BOOL oldNimErrFin13_;
NI16* envstring_2;
NimStringV2 T21_;
NI16* s_1;
wchar_t* T27_;
wchar_t* T28_;
NIM_BOOL oldNimErrFin1_;
NIM_BOOL* nimErr_;
{
		nimErr_ = nimErrorFlag();
result = ((int) 0);
nimZeroMem(((void*) ((&colontmpD_))), sizeof(tyObject_WideCStringObj__Y4mbfz4JpRWlVii9b3ufnsg));
colontmpD__2.len = 0;
colontmpD__2.p = NIM_NIL;
nimZeroMem(((void*) ((&colontmpD__3))), sizeof(tyObject_WideCStringObj__Y4mbfz4JpRWlVii9b3ufnsg));
nimZeroMem(((void*) ((&colontmpD__4))), sizeof(tyObject_WideCStringObj__Y4mbfz4JpRWlVii9b3ufnsg));
colontmpD_ = newWideCString__stdZwidestrs_u325(name_p0);
if (NIM_UNLIKELY((*nimErr_))) {
	goto LA1_;
}
wideName_1 = toWideCString__stdZwidestrs_u49(colontmpD_);
if (NIM_UNLIKELY((*nimErr_))) {
	goto LA1_;
}
{
	NIM_BOOL T4_;
wchar_t* T6_;
T4_ = ((NIM_BOOL) 0);
T4_ = (overwrite_p2 == ((NI32) 0));
if ((!(T4_))) {
	goto LA5_;
}
T6_ = ((wchar_t*) 0);
T6_ = _wgetenv(((wchar_t*) (wideName_1)));
T4_ = (!((T6_ == ((wchar_t*) NIM_NIL))));
LA5_: ;
if ((!(T4_))) {
	goto LA7_;
}
result = ((int) 0);
eqdestroy___stdZwidestrs_u7(colontmpD__4);
if (NIM_UNLIKELY((*nimErr_))) {
	goto BeforeRet_;
}
eqdestroy___stdZwidestrs_u7(colontmpD__3);
if (NIM_UNLIKELY((*nimErr_))) {
	goto BeforeRet_;
}
eqdestroy___system_u2624(colontmpD__2);
eqdestroy___stdZwidestrs_u7(colontmpD_);
if (NIM_UNLIKELY((*nimErr_))) {
	goto BeforeRet_;
}
goto BeforeRet_;
}
LA7_: ;
{
	NimStringV2 colontmpD__5;
tyObject_WideCStringObj__Y4mbfz4JpRWlVii9b3ufnsg colontmpD__6;
NI16* envstring_1;
NimStringV2 T14_;
int e_1;
if ((!((!((value_p1.len == 0)))))) {
	goto LA11_;
}
colontmpD__5.len = 0;
colontmpD__5.p = NIM_NIL;
nimZeroMem(((void*) ((&colontmpD__6))), sizeof(tyObject_WideCStringObj__Y4mbfz4JpRWlVii9b3ufnsg));
T14_.len = 0;
T14_.p = NIM_NIL;
T14_ = rawNewString(((1 + name_p0.len) + value_p1.len));
appendString(((&T14_)), name_p0);
appendString(((&T14_)), TM__UOYsq9cbb0VE8vr3Xt181HA_3);
appendString(((&T14_)), value_p1);
colontmpD__5 = T14_;
colontmpD__6 = newWideCString__stdZwidestrs_u325(colontmpD__5);
if (NIM_UNLIKELY((*nimErr_))) {
	goto LA13_;
}
envstring_1 = toWideCString__stdZwidestrs_u49(colontmpD__6);
if (NIM_UNLIKELY((*nimErr_))) {
	goto LA13_;
}
e_1 = _wputenv(((wchar_t*) (envstring_1)));
{
	if ((!((!((e_1 == ((NI32) 0))))))) {
	goto LA17_;
}
errno = ((int) 22);
result = ((int) -1);
eqdestroy___stdZwidestrs_u7(colontmpD__6);
if (NIM_UNLIKELY((*nimErr_))) {
	goto LA1_;
}
eqdestroy___system_u2624(colontmpD__5);
eqdestroy___stdZwidestrs_u7(colontmpD__4);
if (NIM_UNLIKELY((*nimErr_))) {
	goto BeforeRet_;
}
eqdestroy___stdZwidestrs_u7(colontmpD__3);
if (NIM_UNLIKELY((*nimErr_))) {
	goto BeforeRet_;
}
eqdestroy___system_u2624(colontmpD__2);
eqdestroy___stdZwidestrs_u7(colontmpD_);
if (NIM_UNLIKELY((*nimErr_))) {
	goto BeforeRet_;
}
goto BeforeRet_;
}
LA17_: ;
result = ((int) 0);
eqdestroy___stdZwidestrs_u7(colontmpD__6);
if (NIM_UNLIKELY((*nimErr_))) {
	goto LA1_;
}
eqdestroy___system_u2624(colontmpD__5);
eqdestroy___stdZwidestrs_u7(colontmpD__4);
if (NIM_UNLIKELY((*nimErr_))) {
	goto BeforeRet_;
}
eqdestroy___stdZwidestrs_u7(colontmpD__3);
if (NIM_UNLIKELY((*nimErr_))) {
	goto BeforeRet_;
}
eqdestroy___system_u2624(colontmpD__2);
eqdestroy___stdZwidestrs_u7(colontmpD_);
if (NIM_UNLIKELY((*nimErr_))) {
	goto BeforeRet_;
}
goto BeforeRet_;
{
	LA13_: ;
}
{
	oldNimErrFin13_ = (*nimErr_);
(*nimErr_) = NIM_FALSE;
eqdestroy___stdZwidestrs_u7(colontmpD__6);
if (NIM_UNLIKELY((*nimErr_))) {
	goto LA1_;
}
eqdestroy___system_u2624(colontmpD__5);
(*nimErr_) = oldNimErrFin13_;
}
if (NIM_UNLIKELY((*nimErr_))) {
	goto LA1_;
}
}
LA11_: ;
T21_.len = 0;
T21_.p = NIM_NIL;
T21_ = rawNewString((3 + name_p0.len));
appendString(((&T21_)), name_p0);
appendString(((&T21_)), TM__UOYsq9cbb0VE8vr3Xt181HA_5);
colontmpD__2 = T21_;
colontmpD__3 = newWideCString__stdZwidestrs_u325(colontmpD__2);
if (NIM_UNLIKELY((*nimErr_))) {
	goto LA1_;
}
envstring_2 = toWideCString__stdZwidestrs_u49(colontmpD__3);
if (NIM_UNLIKELY((*nimErr_))) {
	goto LA1_;
}
{
	int T24_;
T24_ = ((int) 0);
T24_ = _wputenv(((wchar_t*) (envstring_2)));
if ((!((!((T24_ == ((NI32) 0))))))) {
	goto LA25_;
}
errno = ((int) 22);
result = ((int) -1);
eqdestroy___stdZwidestrs_u7(colontmpD__4);
if (NIM_UNLIKELY((*nimErr_))) {
	goto BeforeRet_;
}
eqdestroy___stdZwidestrs_u7(colontmpD__3);
if (NIM_UNLIKELY((*nimErr_))) {
	goto BeforeRet_;
}
eqdestroy___system_u2624(colontmpD__2);
eqdestroy___stdZwidestrs_u7(colontmpD_);
if (NIM_UNLIKELY((*nimErr_))) {
	goto BeforeRet_;
}
goto BeforeRet_;
}
LA25_: ;
T27_ = ((wchar_t*) 0);
T27_ = _wgetenv(((wchar_t*) (wideName_1)));
s_1 = ((NI16*) (T27_));
s_1[((NI) 0)] = ((NI16) 0);
T28_ = ((wchar_t*) 0);
T28_ = _wgetenv(((wchar_t*) (wideName_1)));
s_1 = ((NI16*) (T28_));
s_1[((NI) 1)] = ((NI16) 61);
{
	size_t requiredSizeS_1;
if ((!((!((_environ == ((NIM_CHAR**) NIM_NIL))))))) {
	goto LA31_;
}
requiredSizeS_1 = wcstombs(((NIM_CHAR*) NIM_NIL), ((wchar_t*) (wideName_1)), ((size_t) 0));
{
	tySequence__lBgZ7a89beZGYPl8PiANMTA buf_1;
NI requiredSize_1;
NIM_CHAR* buf2_1;
if ((!((!((requiredSizeS_1 == ((size_t) -1))))))) {
	goto LA35_;
}
buf_1.len = 0;
buf_1.p = NIM_NIL;
requiredSize_1 = ((NI) (requiredSizeS_1));
buf_1 = newSeq__stdZprivateZwin95setenv_u59((((NI) (requiredSize_1 + ((NI) 1)))));
buf2_1 = ((&(buf_1).p->data[((NI) 0)]));
{
	size_t T39_;
NCSTRING ptrToEnv_1;
T39_ = ((size_t) 0);
T39_ = wcstombs(buf2_1, ((wchar_t*) (wideName_1)), ((size_t) (((NI) (requiredSize_1 + ((NI) 1))))));
if ((!((!((T39_ == ((size_t) -1))))))) {
	goto LA40_;
}
ptrToEnv_1 = getenv(((NCSTRING) (buf2_1)));
ptrToEnv_1[((NI) 0)] = 0;
ptrToEnv_1 = getenv(((NCSTRING) (buf2_1)));
ptrToEnv_1[((NI) 1)] = 61;
}
LA40_: ;
eqdestroy___stdZprivateZwin95setenv_u144(buf_1);
}
LA35_: ;
}
LA31_: ;
{
	NI16* T44_;
NI32 T45_;
colontmpD__4 = newWideCString__stdZwidestrs_u325(value_p1);
if (NIM_UNLIKELY((*nimErr_))) {
	goto LA1_;
}
T44_ = ((NI16*) 0);
T44_ = toWideCString__stdZwidestrs_u49(colontmpD__4);
if (NIM_UNLIKELY((*nimErr_))) {
	goto LA1_;
}
T45_ = ((NI32) 0);
T45_ = Dl_1694498819_(wideName_1, T44_);
if ((!((T45_ == ((NI32) 0))))) {
	goto LA46_;
}
errno = ((int) 22);
result = ((int) -1);
eqdestroy___stdZwidestrs_u7(colontmpD__4);
if (NIM_UNLIKELY((*nimErr_))) {
	goto BeforeRet_;
}
eqdestroy___stdZwidestrs_u7(colontmpD__3);
if (NIM_UNLIKELY((*nimErr_))) {
	goto BeforeRet_;
}
eqdestroy___system_u2624(colontmpD__2);
eqdestroy___stdZwidestrs_u7(colontmpD_);
if (NIM_UNLIKELY((*nimErr_))) {
	goto BeforeRet_;
}
goto BeforeRet_;
}
LA46_: ;
result = ((int) 0);
eqdestroy___stdZwidestrs_u7(colontmpD__4);
if (NIM_UNLIKELY((*nimErr_))) {
	goto BeforeRet_;
}
eqdestroy___stdZwidestrs_u7(colontmpD__3);
if (NIM_UNLIKELY((*nimErr_))) {
	goto BeforeRet_;
}
eqdestroy___system_u2624(colontmpD__2);
eqdestroy___stdZwidestrs_u7(colontmpD_);
if (NIM_UNLIKELY((*nimErr_))) {
	goto BeforeRet_;
}
goto BeforeRet_;
{
	LA1_: ;
}
{
	oldNimErrFin1_ = (*nimErr_);
(*nimErr_) = NIM_FALSE;
eqdestroy___stdZwidestrs_u7(colontmpD__4);
if (NIM_UNLIKELY((*nimErr_))) {
	goto BeforeRet_;
}
eqdestroy___stdZwidestrs_u7(colontmpD__3);
if (NIM_UNLIKELY((*nimErr_))) {
	goto BeforeRet_;
}
eqdestroy___system_u2624(colontmpD__2);
eqdestroy___stdZwidestrs_u7(colontmpD_);
if (NIM_UNLIKELY((*nimErr_))) {
	goto BeforeRet_;
}
(*nimErr_) = oldNimErrFin1_;
}
if (NIM_UNLIKELY((*nimErr_))) {
	goto BeforeRet_;
}
}
	BeforeRet_: ;
		return result;
}

N_LIB_PRIVATE N_NIMCALL(void, atpstdatsprivateatswin_setenvdotnim_DatInit000)(void) {
	TM__UOYsq9cbb0VE8vr3Xt181HA_6 = nimLoadLibrary(TM__UOYsq9cbb0VE8vr3Xt181HA_9);
if ((!(TM__UOYsq9cbb0VE8vr3Xt181HA_6))) {
	nimLoadLibraryError(TM__UOYsq9cbb0VE8vr3Xt181HA_11);
}
	Dl_1694498819_ = ((tyProc__bqj9c9cp9clcknaC0kHFkuNVg) nimGetProcAddr(TM__UOYsq9cbb0VE8vr3Xt181HA_6, "SetEnvironmentVariableW"));
}


